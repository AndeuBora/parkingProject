<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"

"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<mapper namespace="PaymentMapper">

	<select id="paymentManagementList" parameterType="com.parking.payment.vo.PaymentVO"
		resultType="com.parking.payment.vo.PaymentVO">

		select
		*
		from (
		select list.*, rownum as rnum
		from (
		select *
		from payment
		<trim prefix="where" prefixOverrides="and">
			<if test="paymentType != 0">
				paymentType = #{paymentType}
			</if>

		<if test="paymentDate !=null">
				and to_char(paymentDate,'yyyy-mm-dd') = #{paymentDate}
			</if>
			
		
			<if test="s_Number == 1">
				and paymentNum = #{justNumber}
			</if>
			<if test="s_Number == 2">
				and bookingNum = #{justNumber}
			</if>
			<if test="s_Number == 3">
				and offlineNum = #{justNumber}
			</if>
		</trim>
		) list
		)
		<where>
			<if test="start_row">
				<if test="end_row">

					rnum between #{start_row} and #{end_row}
				</if>
			</if>
		</where>
	</select>

	<select id="paymentListCnt" parameterType="com.parking.payment.vo.PaymentVO"
		resultType="int">

		SELECT NVL(count(1),0)FROM (select list.* , rownum as rnum
		from(
		select
		paymentNum,
		cardCompany,cardNum,cardValid,cardCVC,paymentMoney,paymentPolicy,paymentDate
		,paymentType,
		paymentPenalty,paymentState,bookingNum,offlineNum
		from
		payment
		<trim prefix="where" prefixOverrides="and">
			<if test="paymentType != 0">
				paymentType = #{paymentType}
			</if>

		<if test="paymentDate !=null">
				and to_char(paymentDate,'yyyy-mm-dd') = #{paymentDate}
			</if>
			
			
			
		
		    
 			<if test="s_Number == 1">
				and paymentNum = #{justNumber}
			</if>
			<if test="s_Number == 2">
				and bookingNum = #{justNumber}
			</if>
			<if test="s_Number == 3">
				and offlineNum = #{justNumber}
			</if>
		</trim>
		) list
		)
	</select>
	
<select id="paymentDateMin" parameterType="com.parking.payment.vo.PaymentVO"
     resultType="com.parking.payment.vo.PaymentVO">
	select min(paymentDate)
from payment
	</select> 
	
</mapper>