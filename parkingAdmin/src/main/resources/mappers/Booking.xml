<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="BookingMapper">
	<!-- 예약관리 -->
	<!-- 예약목록 조회 -->
	<select id="selectBookingList" parameterType="com.parking.booking.vo.BookingVO"
		resultType="com.parking.booking.vo.BookingVO">
		SELECT
		*
		FROM (select list.*, rownum as rnum
		FROM(
		select * from
		booking
		<trim prefix="where" prefixOverrides="and">
			<if test="startDate != 'all'">
				bookingDate between #{startDate} and #{endDate}
			</if>
			<if test="bookingState != 3">
				and bookingState = #{bookingState}
			</if>
			<if test="bookingNum!='all'">
				and bookingNum = #{bookingNum}
			</if>
		</trim>
		order by applicationDate desc
		)list)
		<if test="startRow">
			<if test="endRow">
				where rnum between #{startRow} and #{endRow}
			</if>
		</if>
	</select>

	<!-- 전체레코드 건수 -->
	<select id="selectBookingListCnt" parameterType="com.parking.booking.vo.BookingVO"
		resultType="int">
		select nvl(count(1),0) FROM (select list.*
		FROM(
		select
		* from
		booking
		<trim prefix="where" prefixOverrides="and">
			<if test="startDate != 'all'">
				bookingDate between #{startDate} and #{endDate}
			</if>
			<if test="bookingState != 3">
				and bookingState = #{bookingState}
			</if>
			<if test="bookingNum!='all'">
				and bookingNum = #{bookingNum}
			</if>
		</trim>
		)list)
	</select>

	<!-- memberInfo -->
	<select id="selectMemberInfo" parameterType="com.parking.booking.vo.BookingVO"
		resultType="com.parking.booking.vo.BookingVO">
		select memberid, memberName from member where
		memberNum=#{memberNum}
	</select>

</mapper>
